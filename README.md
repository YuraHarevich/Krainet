# Krainet test task

## Инструкция по запуску
1) склонировать репозиторий
2) из корня проекта вызвать команду docker compose -f docker/docker-compose-prod.yml up -d
## Архитектура
**Микросервисы:**
- `user-service` - управление пользователями
- `notification-service` - отправка сообщений

## Особенности и пояснения по реализации требований задания
1) Все энд поинты можно протестировать с помощью postman коллекции https://name88-0647.postman.co/workspace/7501567d-10f1-4e9f-9569-d4584b9648aa/collection/35977430-f07a53cf-e5a6-423c-943d-963804c31506?action=share&source=copy-link&creator=35977430
2) в приложении использовано 2 вида связи (асинхронная - Kafka, синхронная - FeignClient)
3) Логирование и сбор метрик реализованы с помощью Grafana stack и логи можно увидеть как в контейнере так и по адресу localhost:3000
4) Миграция усложнилась всвязи с тем что авторизация осуществляется связкой user-service и keycloak. Для решения проблемы при запуске в keycloak импортируется realm вместе с пользователями, а миграция обычной бд user-service-а осуществляется с помощью liquibase
5) При каких-либо действиях совершаемых пользователей с ролью USER всем пользователям с ролью ADMIN приходят сообщения на почту, эту рассылку можно отключить с помощью настройки notification:email:enabled:false в notification-service в файле настройки application-prod.yml
6) Отдельный endpoint для добавления роли admin пользователю я посчитал избыточным. Для тестирования рассылки роль можно добавить в админке keycloak:
- обращаемся по адресу http://localhost:8080/admin/master/console/#/krainet-realm/users там будет список всех пользователей
- кликаем на интересующего пользователя
- далее выбираем вкладку Role mapping и нажимаем синию кнопку Assign Role
- слева будет кнопка с надписью filter by client, на нее нужно нажать и в выпадающем меню выбрать filter by realm roles
- далее выбираем роль ADMIN и нажимаем кнопку Assign
  
